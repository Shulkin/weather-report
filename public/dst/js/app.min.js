angular.module("app.config",[]).value("OWM_API_KEY","1ba7401f0fd8de8800f868d0400afc44"),angular.module("app.routes",[]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/map"),a.state("map",{url:"/map",templateUrl:"./views/ol3-map.html",controller:"MapCtrl as map"})}]);var app=angular.module("app",["ui.router","app.config","app.routes","ol3.map.ctrl","ol3.map.service","cities.service","weather.data.service"]);angular.module("ol3.map.ctrl",[]).controller("MapCtrl",["ol3Map","Cities",function(a,b){function c(){a.init({}),a.loadWeather(b.all())}c()}]),angular.module("cities.service",[]).factory("Cities",[function(){return{all:function(){return[{id:"2013348",name:"Vladivostok"}]},toString:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].id,c<a.length-1&&(b+=",");return b}}}]),angular.module("ol3.map.service",[]).factory("ol3Map",["Cities","WeatherData",function(a,b){var c={},d={zoom:6,startLocation:[134.6,45.3]};return{map:c,init:function(a){a=angular.extend(d,a),c=new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.OSM})],view:new ol.View({center:ol.proj.transform(a.startLocation,"EPSG:4326","EPSG:3857"),zoom:a.zoom})})},loadWeather:function(d){b.getWeatherById(a.toString(d)).then(function(a){for(var d=a.list,e=[],f=0;f<d.length;f++){var g=d[f],h=g.coord.lat,i=g.coord.lon,j=Math.round(g.main.temp),k=new ol.style.Style({image:new ol.style.Icon({opacity:.9,src:b.getWeatherIconUrl(g.weather[0].icon)}),text:new ol.style.Text({textAlign:"center",textBaseline:"middle",font:"17px Arial",text:g.name,fill:new ol.style.Fill({color:"#000000"}),stroke:new ol.style.Stroke({color:"#ffffff",width:2}),offsetY:21})}),l=new ol.style.Style({text:new ol.style.Text({textAlign:"left",textBaseline:"middle",font:"17px Arial",text:j+" Â°C",fill:new ol.style.Fill({color:"#000000"}),stroke:new ol.style.Stroke({color:"#ffffff",width:2}),offsetX:21})}),m=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([i,h],"EPSG:4326","EPSG:3857"))});m.setStyle([k,l]),e.push(m)}var n=new ol.source.Vector({features:e}),o=new ol.layer.Vector({source:n});c.addLayer(o)},function(a){console.log("Error "+a)})}}}]),angular.module("weather.data.service",[]).factory("WeatherData",["OWM_API_KEY","$http",function(a,b){var c="http://api.openweathermap.org/data/2.5/",d="http://openweathermap.org/img/w/";return{getWeatherById:function(d){return b.get(c+"group?id="+d+"&units=metric&appid="+a).then(function(a){return a.data})},getForecastById:function(d){return b.get(c+"weather?id="+d+"&units=metric&appid="+a).then(function(a){return a.data})},getWeatherIconUrl:function(a){return d+a+".png"}}}]);